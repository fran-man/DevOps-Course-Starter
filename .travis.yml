services:
  - docker

script:
  - echo "$DOCKER_PASS" | docker login --username georgefrancis --password-stdin
  - docker build --target test --tag devops-starter:test0.1 .
  - docker run --mount type=bind,source="$(pwd)",target=/app --env TRELLO_KEY --env TRELLO_TKN --env TRELLO_BOARD devops-starter:test0.1 .
  - docker build --target production --tag georgefrancis/devops-starter:"$TRAVIS_COMMIT" .

after_success:
  - docker tag georgefrancis/devops-starter:"$TRAVIS_COMMIT" georgefrancis/devops-starter:latest
  - docker push georgefrancis/devops-starter:"$TRAVIS_COMMIT"
  - docker push georgefrancis/devops-starter:latest